<!DOCTYPE html>

<!--Settings Modal-->
<div class="modal-dialog modal-lg" id="ajax-settings">
  <div class="modal-content">
    <div class="modal-header">
      <h4 class="modal-title">Settings</h4>
      <button type="button" class="close" data-dismiss="modal" onclick="settingsCancelMsg();"><span>&times;</span></button>
    </div>
    <div class="modal-body text-left">
      <!--local-warning-banner-->
      <div id="ajax-settings-warning-banner"></div>
      <div class="container">
        <!--Theme-->
        <div class="card-deck">
          <div class="card bg-secondary">
            <h5 class="card-header">Appearance</h5>
            <div class="card-body">
              <p class="card-text">Customize the appearance of the site.</p>
              <!--Dark/Light Radios-->
              <div class="form-check">
                <label class="form-check-label">
                  <input class="form-check-input" type="radio" name="themeStyle" id="theme-radio1" value="dark" checked>
                  Dark
                </label>
              </div>
              <div class="form-check">
                <label class="form-check-label" data-toggle="tooltip" data-html="true" data-placement="right" title="This theme <b>does not</b> get much attention. Some elements might look unpolished.">
                  <input class="form-check-input" type="radio" name="themeStyle" id="theme-radio2" value="light">
                  Light
                </label>
              </div><!--./Dark/Light Radios-->
              <hr>
              <!--Hidden-->
              <div class="collapse mx-auto" id="collapse-more">
                <!--Centered Modals-->
                <div class="form-check">
                    <label class="form-check-label">
                      <input class="form-check-input" type="checkbox" name="centerModals" id="modal-centered-checkbox1" value="true">
                      Center modals
                    </label>
                  </div>
                  <hr>
                  <!--Background Color-->
                  <div class="form-group">
                    <label for="bg-color-hex">Background color</label>
                    <input id="bg-color-hex" type="text" class="form-control form-control-sm" name="backgroundColor" placeholder="Hex value (blank for default)" style="max-width:200px;">
                  </div>
                  <!--Terminal Opacity-->
                  <hr>
                  <div class="form-group">
                    <div class="row">
                      <div class="col">
                        <label for="terminal-opacity">Terminal Opacity</label>
                        <input id="terminal-opacity" type="range" class="form-control form-control-sm" name="terminalOpacity"  min="0" max="1" step="0.1" value="0.8" style="max-width:200px;">
                      </div>
                      <div class="col">
                        <label id="terminal-opacity-value"></label>
                      </div>
                    </div>
                  </div>
              </div>
              <!--More Button-->
              <button id="more-options-btn" type="button" class="btn btn-dark btn-sm btn-block" onclick="$('#collapse-more').collapse('toggle'); showOptions();">
                <i class="fa fa-cogs"></i> <span id="btn-more-options-text">More options</span> <i id="btn-more-options-icon" class="fas fa-chevron-down"></i>
              </button>
            </div>
          </div>
          <!--News Page-->
          <div class="card bg-secondary">
            <h5 class="card-header">News page</h5>
            <div class="card-body">
              <p class="card-text">Select the default tab.</p>
              <div class="form-check">
                <label class="form-check-label">
                  <input class="form-check-input" type="radio" name="defaultTab" id="news-radio1" value="projects" checked>
                  Projects
                </label>
              </div>
              <div class="form-check">
                <label class="form-check-label">
                  <input class="form-check-input" type="radio" name="defaultTab" id="news-radio2" value="important">
                  Important
                </label>
              </div>
              <div class="form-check">
                <label class="form-check-label">
                  <input class="form-check-input" type="radio" name="defaultTab" id="news-radio3" value="website">
                  Website
                </label>
              </div>
              <div class="form-check">
                <label class="form-check-label">
                  <input class="form-check-input" type="radio" name="defaultTab" id="news-radio4" value="bugs">
                  Bugs
                </label>
              </div>
            </div>
          </div>
        </div><!--./card-deck-->

        <br>

        <!--Banners-->
        <div class="card-deck">
          <div class="card bg-secondary">
            <h5 class="card-header">Banners</h5>
            <div class="card-body">
              <p class="card-text">Select the type of banners you want to see.</p>
              <div class="form-check">
                <label class="form-check-label">
                  <input class="form-check-input" type="checkbox" name="banners-info" id="info-banner-checkbox1" value="true">
                  Information
                </label>
              </div>
              <div class="form-check">
                <label class="form-check-label">
                  <input class="form-check-input" type="checkbox" name="banners-privacy" id="legal-banner-checkbox1" value="true">
                  Legal
                </label>
              </div>
              <div class="form-check">
                <label class="form-check-label">
                  <input class="form-check-input" type="checkbox" name="banners-homepage" id="home-banner-checkbox1" value="true">
                  Events
                </label>
              </div>
            </div>
          </div>

        <!--Page Load-->
          <div class="card bg-secondary">
            <h5 class="card-header">On page load...</h5>
            <div class="card-body">
              <p class="card-text">What happens when the page loads.</p>
              <div class="form-check">
                <label class="form-check-label" id="load-terminal">
                  <input class="form-check-input" type="checkbox" name="loadTerminal" id="terminal-checkbox1" value="true">
                  Load Terminal assets
                </label>
              </div>
              <div class="form-check disabled" id="toggle-terminal">
                <label class="form-check-label">
                  <input class="form-check-input" type="checkbox" name="toggle-terminal" id="terminal-checkbox2" value="true" disabled>
                  Toggle Terminal
                </label>
              </div>
              <div class="form-check">
                <label class="form-check-label">
                  <input class="form-check-input" type="checkbox" name="toggle-snowstorm" id="snowstorm-checkbox1" value="true">
                  Enable snowstorm
                </label>
              </div>
            </div>
          </div>
        </div><!--/.dark-deck-->
      </div><!--/.container-->
    </div><!--/.modal-body-->
    <!--Settings Help Collapsible Content-->
    <div class="collapse" id="modal-settings-collapse">
      <div class="card bg-secondary">
        <h5 class="card-header">Help <button type="button" class="close" onclick="$('#modal-settings-collapse').collapse('toggle');"><span>&times;</span></button></h5>
        <div class="card-body">
          <p class="card-text">
            Configure website preferences to your liking.<br>
            Simply select what you prefer and click save.
          </p>
          <hr>
          <h6>Note:</h6>
          <p class="card-text">
            Clicking or tapping the "Cancel" button will not save your changes.<br>
            Centered modals do not work on small displays.
          </p>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button type="button" id="default-settings" class="btn btn-outline-danger mr-auto" data-dismiss="modal" onclick="loadResetSettingsMod();" data-toggle="tooltip" data-placement="right" title="Reset settings"> Reset
        <i class="fa fa-exclamation-triangle"></i>
      </button>
      <button type="button" class="btn btn-outline-info" onclick="$('#modal-settings-collapse').collapse('toggle');">
        <i class="fa fa-question-circle"></i>
      </button>
      <button type="button" class="btn btn-outline-danger" data-dismiss="modal" onclick="settingsCancelMsg();">
        <i class="fa fa-times"></i> Cancel
      </button>
      <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="settingsCheck();"> Save
        <i class="far fa-save"></i>
      </button>
    </div><!-- /.modal-footer -->
  </div><!-- /.modal-content -->
</div><!-- /.modal-settings-->

<script>
  var btnMoreCounter = 0;
  var termAssetsCounter = 0;

  $(function() {
    settings.getItem('theme').then(function(value) {
      if (value == 'light') {
        $('.btn.btn-dark').removeClass('btn-dark').addClass('btn-secondary');
        $('.card.bg-secondary').removeClass('bg-secondary').addClass('border-dark');
      }
    });
    settings.getItem('centeredModals').then(function(value) {
      if (value == 'true') {
        $('.modal-dialog').addClass('modal-dialog-centered');
      }
      console.log('centeredModals = ' + value);
    });
  });

  function showOptions() {
    if (btnMoreCounter % 2 === 0) {
      $("#btn-more-options-icon").attr("data-fa-transform", "rotate-180");
      $("#btn-more-options-text").text("Less options");
    } 
    else {
      $("#btn-more-options-icon").attr("data-fa-transform", "rotate-360");
      $("#btn-more-options-text").text("More options");
    }
    btnMoreCounter++;
  }

  function defaultSettings() {
    $('#default-settings').tooltip('hide');
    settings.clear();

    setTimeout(enable, 2000);
    PNotify.notice({
      text: 'Settings have been reset!'
    });
    PNotify.notice({
      text: 'Reloading page...'
    });
    function enable(){
      location.reload();
    }
  }

  //Re enable tooltips.
  if(!('ontouchstart' in window)) {
    $('[data-toggle="tooltip"]').tooltip({
      trigger: 'hover',
    });
  }

  //Checks which inputs should be selected
  $(function() {
    //Theme
    settings.getItem('theme').then(function(value) {
      if (value == 'dark') {
        $("#theme-radio1").prop("checked", true);
      }
      if (value == 'light') {
        $("#theme-radio2").prop("checked", true);
      }
    }).catch(function(err) {
      console.log(err);
    });
    //Centered modals
    settings.getItem('centeredModals').then(function(value) {
      if (value == 'true') {
        $("#modal-centered-checkbox1").prop("checked", true);
      }
    }).catch(function(err) {
      console.log(err);
    });
    //Terminal Opacity
    settings.getItem('terminalOpacity').then(function(value) {
      $('#terminal-opacity').prop("value", value);
      $('#terminal-opacity-value').html(value);
    }).catch(function(err) {
      console.log(err);
    });
    //Banner - Events
    settings.getItem('enableEventsBanner').then(function(value) {
      if (value == 'true') {
        $("#home-banner-checkbox1").prop("checked", true);
      }
    }).catch(function(err) {
      console.log(err);
    });
    //Banner - Info
    settings.getItem('enableInfoBanner').then(function(value) {
      if (value == 'true') {
        $("#info-banner-checkbox1").prop("checked", true);
      }
    }).catch(function(err) {
      console.log(err);
    });
    //Banner - Legal
    settings.getItem('enableLegalBanner').then(function(value) {
      if (value == 'true') {
        $("#legal-banner-checkbox1").prop("checked", true);
      }
    }).catch(function(err) {
      console.log(err);
    });
    //News
    settings.getItem('defaultTab').then(function(value) {
      if (value == 'projects') {
        $("#news-radio1").prop("checked", true);
      }
      else if (value == 'important') {
        $("#news-radio2").prop("checked", true);
      }
      else if (value == 'website') {
        $("#news-radio3").prop("checked", true);
      }
      else if (value == 'bugs') {
        $("#news-radio4").prop("checked", true);
      }
    }).catch(function(err) {
      console.log(err);
    });
    //On page load - Snowstorm
    settings.getItem('enableSnowstorm').then(function(value) {
      if (value == 'true') {
        $("#snowstorm-checkbox1").prop("checked", true);
      }
    }).catch(function(err) {
      console.log(err);
    });
    //On page load - Terminal
    settings.getItem('loadTerminal').then(function(value) {
      if (value == 'true') {
        $("#terminal-checkbox1").prop("checked", true);
        $("#toggle-terminal").removeClass('disabled');
        $("#terminal-checkbox2").prop("disabled", false);
        termAssetsCounter++;
      }
    }).catch(function(err) {
      console.log(err);
    });
    //On page load - Toggle Terminal
    settings.getItem('toggleTerminal').then(function(value) {
      if (value == 'true') {
        $("#terminal-checkbox2").prop("checked", true);
      }
    }).catch(function(err) {
      console.log(err);
    });
    //Set background color
    settings.getItem('backgroundColor').then(function(value) {
      $('#bg-color-hex').attr("value", value);
    }).catch(function(err) {
      console.log(err);
    });

    $('#terminal-checkbox1').click(function() {
      console.log('Settings: Load terminal clicked');

      if (termAssetsCounter % 2 === 0) {
        $("#toggle-terminal").removeClass('disabled');
        $("#terminal-checkbox2").prop("disabled", false);
        console.log('Settings: Toggle Terminal enabled');
      }
      else {
        $("#toggle-terminal").addClass('disabled');
        $("#terminal-checkbox2").prop("disabled", true);
        console.log('Settings: Toggle Terminal disabled');
      }
      termAssetsCounter++;
    });

    //Terminal Opacity
    $('#terminal-opacity-value').html($('#terminal-opacity').val());
    $(document).on('input', '#terminal-opacity', function() {
      if ($(this).val() == 1) {
        $('#terminal-opacity-value').html( $(this).val() + ' (Opaque)' );
      }
      else if ($(this).val() == 0.8) {
        $('#terminal-opacity-value').html( $(this).val() + ' (Default)' );
      }
      else if ($(this).val() == 0) {
        $('#terminal-opacity-value').html( $(this).val() + ' (Transparent)' );
      }
      else {
        $('#terminal-opacity-value').html( $(this).val() );
      }
    });
  });
</script>
